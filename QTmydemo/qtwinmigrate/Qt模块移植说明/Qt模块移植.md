## Qt模块移植

### 一、实现功能

​		新建项目，按要求实现需要替换功能。

#### 1、编译器选择

​		Qt_5_9_9_MinGW_32bit。

#### 2、实现要求

​		1)需要将**功能代码**和**测试代码**分文件实现。方便后续将**功能实现文件**加入到**动态库**。

​		2)**功能代码**的“.h”文件不能引用qt系统文件。只声明功能实现函数。		

### 二、添加到动态库（qtwinmigrate）

#### 1、工程复制

​		将新实现的QT工程项目复制到“dso_demo\qtwinmigrate\examples\qtdll”文件夹下面。

#### 2、将功能代码文件添加到动态库

1)打开qt工程“qtwinmigrate”。

2)右键点击“qtdll”,选择添加现有文件。

![](.\图片\qtdll_功能文件添加.png)

3）选择**功能文件**进行添加。

#### 3、动态库编译

1）选择“Qt_5_9_9_MinGW_32bit”编译器。

2）对**功能代码**的“.h”文件的函数声明添加前缀“extern "C" __declspec(dllexport)”。

​	注意：如果“.h”中有中文注释，需要将**utf-8**转码为**GB2312**编码格式，因为vc6可能不能识别**utf-8**的中文编码。

3）编译工程“qtwinmigrate”，将“\dso_demo\build-qtwinmigrate-Desktop_Qt_5_9_9_MinGW_32bit-Debug\examples\qtdll\debug”文件夹下的“qtdialog.dll”，“libqtdialog.a”复制到"\dso_demo\DSO6932\libs"文件夹下面。

#### 4、调用动态库，替换功能函数

1)调用动态库

​		在需要调用动态库的".cpp"文件中引用**"QtWinMigrate.h"**，**功能代码的”.h“**文件。

2)调用功能函数。

​		注意：不能删除原实现，将原实现条件编译，改为调用动态库中的功能函数。

3）编译项目工程，验证功能是否移植成功。

#### 5、删除之前的新建项目

​		删除之前的新建项目，并提交至服务器。